<template>
  <div
    class="flex nowrap gap-3 p-3 dark:border-neutral-600 border-b-2 justify-between"
  >
    <label
      class="relative text-neutral-400 focus-within:text-gray-600 block flex-grow"
    >
      <input
        v-model="searchString"
        :placeholder="placeholder"
        class="w-full px-1 py-[0.4375rem] pl-2.5 text-sm rounded-sm border text-black dark:text-white bg-neutral-50 dark:bg-neutral-900 border-neutral-300 dark:border-neutral-600 placeholder:italic placeholder:text-neutral-500 dark:placeholder:text-neutral-400"
        @keydown="onKeyDown"
      />
    </label>
    <button class="w-6 text-action-" @click="triggerSearch">
      <SearchIcon class="w-full text-neutral-500" />
    </button>
  </div>
</template>

<script lang="ts" setup>
import _ from "lodash";
import { SearchIcon } from "@heroicons/vue/solid";
import { ref, watch } from "vue";

// TODO: we may want to swap this over to vmodel instead, but we'll see
const searchString = ref("");

const emit = defineEmits<{
  (e: "search", searchTerm: string): void;
}>();

const props = defineProps({
  placeholder: { type: String, default: "search..." },
  modelValue: { type: String },
  autoSearch: { type: Boolean },
});

function triggerSearch() {
  emit("search", searchString.value);
}

// if autoSearch prop is true, we'll trigger the search event as the user types (debounced)
// rather than only when they click the search icon
watch(() => searchString.value, _.debounce(triggerAutoSearch, 50));

function triggerAutoSearch() {
  if (props.autoSearch) triggerSearch();
}

function onKeyDown(e: KeyboardEvent) {
  if (e.key === "Enter") triggerSearch();
}
</script>
