pub async fn update(
    &mut self,
    db: &si_data::Db,
    change_set_id: Option<String>,
    update: <%- fmt.implUpdateRequestType({ reference: false, option: true }) %>,
) -> si_cea::CeaResult<()> {
    let item_id = self.id.as_ref().map(|change_set_enabled_id| {
        let split_result: Vec<&str> = change_set_enabled_id.split(":").collect();
        let item_id = if split_result.len() == 2 {
            format!("{}:{}", split_result[0], split_result[1])
        } else {
            format!("{}:{}", split_result[3], split_result[4])
        };
        item_id
    });
    self.si_storable.as_mut().map(|si_storable| {
        si_storable.change_set_id = change_set_id;
        si_storable.deleted = Some(false);
        si_storable.set_change_set_event_type(si_data::DataStorableChangeSetEventType::Update);
        si_storable.item_id = item_id;
        si_storable.change_set_executed = Some(false);
        si_storable
    });

    if let Some(update) = update {
        if update.name.is_some() {
            self.name = update.name;
        }
        if update.display_name.is_some() {
            self.display_name = update.display_name;
        }
        if update.description.is_some() {
            self.description = update.description;
        }
        if update.properties.is_some() {
            self.properties = update.properties;
        }
<%_ if (fmt.newEntityPropertyUpdates() || fmt.newEntityPropertyEithers()) { _%>

    <%- include('implEntityCreateUpdatesAndEithers.rs.ejs', { fmt: fmt, variable: 'self' }) %>
<%_ } _%>
    }

    db.update(self).await?;
    Ok(())
}

pub async fn delete(
    &mut self,
    db: &si_data::Db,
    change_set_id: Option<String>,
) -> si_cea::CeaResult<()> {
    let item_id = self.id.as_ref().map(|change_set_enabled_id| {
        let split_result: Vec<&str> = change_set_enabled_id.split(":").collect();
        let item_id = if split_result.len() == 2 {
            format!("{}:{}", split_result[0], split_result[1])
        } else {
            format!("{}:{}", split_result[3], split_result[4])
        };
        item_id
    });
    self.si_storable.as_mut().map(|si_storable| {
        si_storable.change_set_id = change_set_id;
        si_storable.deleted = Some(true);
        si_storable.set_change_set_event_type(si_data::DataStorableChangeSetEventType::Delete);
        si_storable.item_id = item_id;
        si_storable.change_set_executed = Some(false);
        si_storable
    });

    db.delete(self).await?;
    Ok(())
}
